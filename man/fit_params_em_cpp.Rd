% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_params.R
\name{fit_params_em_cpp}
\alias{fit_params_em_cpp}
\title{Fit tree parameters using EM (BP-backed, native ordering)}
\usage{
fit_params_em_cpp(
  tree_fit,
  amat,
  dmat,
  initial_params = c(ngen = 100, log_eps = log(0.001), log_err = log(0.001)),
  lower_bounds = c(ngen = 1, log_eps = log(1e-12), log_err = log(1e-12)),
  upper_bounds = c(ngen = 1000, log_eps = log(0.2), log_err = log(0.2)),
  max_iter = 10,
  k = 20,
  npop = 600,
  ncores = 1,
  epsilon = 0.001,
  trace = TRUE
)
}
\arguments{
\item{tree_fit}{phylogenetic tree (will be renumbered)}

\item{amat}{alternative allele counts}

\item{dmat}{total depth matrix}

\item{initial_params}{named numeric: ngen, log_eps, log_err}

\item{lower_bounds}{named numeric lower bounds (same names)}

\item{upper_bounds}{named numeric upper bounds (same names)}

\item{max_iter}{maximum EM iterations}

\item{k}{number of hidden states (VAF bins)}

\item{npop}{population size for WF-HMM transition}

\item{ncores}{kept for API compatibility (unused here)}

\item{epsilon}{convergence threshold on parameter deltas}

\item{trace}{if TRUE, returns trace dataframe}
}
\value{
either named vector of final params (ngen, eps, err) or list(par=..., trace=...)
}
\description{
A faster EM that uses compute_node_edge_beliefs_bp2() directly.
It relies on the inherent ordering used by the C++ routine:
\itemize{
\item node_beliefs[\link{locus}] is an n x C matrix in APE node-id order (1..n)
\item edge_beliefs[\link{locus}] is an m x C x C array where the m edges correspond
to the post-ordered edge list internal to the C++ routine (order is irrelevant
because we sum over edges).
}
}
\keyword{internal}
