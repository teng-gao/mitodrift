% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/class.R
\name{MitoDrift}
\alias{MitoDrift}
\title{MitoDrift R6 Class}
\description{
MitoDrift R6 Class

MitoDrift R6 Class
}
\details{
A class for mitochondrial drift analysis with tree-based inference
}
\section{Public fields}{
\if{html}{\out{<div class="r6-fields">}}
\describe{
\item{\code{tree_init}}{Initial phylogenetic tree (ape::phylo)}

\item{\code{A}}{Transition matrix}

\item{\code{leaf_likelihoods}}{List of leaf likelihoods}

\item{\code{logA}}{Vector of log transition probabilities}

\item{\code{logP}}{List of log probabilities}

\item{\code{model_params}}{Named vector containing model parameters (eps, err, npop, ngen, k)}

\item{\code{amat}}{Alternative allele count matrix}

\item{\code{dmat}}{Total depth matrix}

\item{\code{vmat}}{VAF matrix}

\item{\code{mcmc_trace}}{MCMC trace for parameter fitting}

\item{\code{tree_list}}{List of trees from optimization}

\item{\code{tree_ml}}{Maximum likelihood tree}

\item{\code{tree_annot}}{Annotated tree with clade frequencies}

\item{\code{ml_trace_file}}{File path for ML trace}

\item{\code{mcmc_trace_file}}{File path for MCMC trace}

\item{\code{param_trace_file}}{File path for parameter fitting trace}
}
\if{html}{\out{</div>}}
}
\section{Methods}{
\subsection{Public methods}{
\itemize{
\item \href{#method-MitoDrift-new}{\code{MitoDrift$new()}}
\item \href{#method-MitoDrift-print}{\code{MitoDrift$print()}}
\item \href{#method-MitoDrift-make_model}{\code{MitoDrift$make_model()}}
\item \href{#method-MitoDrift-fit_params_mcmc}{\code{MitoDrift$fit_params_mcmc()}}
\item \href{#method-MitoDrift-fit_params_em}{\code{MitoDrift$fit_params_em()}}
\item \href{#method-MitoDrift-optimize_tree}{\code{MitoDrift$optimize_tree()}}
\item \href{#method-MitoDrift-optimize_tree_em}{\code{MitoDrift$optimize_tree_em()}}
\item \href{#method-MitoDrift-run_mcmc}{\code{MitoDrift$run_mcmc()}}
\item \href{#method-MitoDrift-annotate_tree}{\code{MitoDrift$annotate_tree()}}
\item \href{#method-MitoDrift-copy}{\code{MitoDrift$copy()}}
\item \href{#method-MitoDrift-clone}{\code{MitoDrift$clone()}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-new"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-new}{}}}
\subsection{Method \code{new()}}{
Initialize MitoDrift object
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$new(mut_dat = NULL, amat = NULL, dmat = NULL, model_params = NULL)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{mut_dat}}{Mutation data in long format (data.frame with columns: variant, cell, d, a)}

\item{\code{amat}}{Alternative allele count matrix (optional, if mut_dat not provided)}

\item{\code{dmat}}{Total depth matrix (optional, if mut_dat not provided)}

\item{\code{model_params}}{Model parameters (optional)}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-print"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-print}{}}}
\subsection{Method \code{print()}}{
Print object summary

Prints a summary of the MitoDrift object including data dimensions,
tree information, model parameters, and available components.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$print()}\if{html}{\out{</div>}}
}

\subsection{Returns}{
None (prints to console)
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-make_model"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-make_model}{}}}
\subsection{Method \code{make_model()}}{
Make model components
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$make_model(model_params = NULL, ncores = 1)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{model_params}}{Model parameters (optional)}

\item{\code{ncores}}{Number of cores to use}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
None
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-fit_params_mcmc"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-fit_params_mcmc}{}}}
\subsection{Method \code{fit_params_mcmc()}}{
Fit tree parameters using MCMC
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$fit_params_mcmc(
  nsteps = 500,
  nchains = 1,
  ncores = 1,
  keep = 100,
  check_conv = FALSE,
  outfile = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{nsteps}}{Number of MCMC steps (default: 500)}

\item{\code{nchains}}{Number of MCMC chains (default: 1)}

\item{\code{ncores}}{Number of cores to use (default: 1)}

\item{\code{keep}}{Number of samples to keep at the end of the chain (default: 100)}

\item{\code{check_conv}}{whether to check convergence of parameter fitting}

\item{\code{outfile}}{Output file for MCMC results (optional)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
MCMC result object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-fit_params_em"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-fit_params_em}{}}}
\subsection{Method \code{fit_params_em()}}{
Fit tree parameters using Expectation-Maximization (EM) algorithm
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$fit_params_em(
  tree_fit,
  initial_params = c(ngen = 100, log_eps = log(0.001), log_err = log(0.001)),
  lower_bounds = c(ngen = 1, log_eps = log(1e-12), log_err = log(1e-12)),
  upper_bounds = c(ngen = 1000, log_eps = log(0.2), log_err = log(0.2)),
  max_iter = 10,
  epsilon = 0.001,
  ncores = 1
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{initial_params}}{Initial parameter values (ngen, log_eps, log_err)}

\item{\code{lower_bounds}}{Lower bounds for parameters in transformed space}

\item{\code{upper_bounds}}{Upper bounds for parameters in transformed space}

\item{\code{max_iter}}{Maximum number of EM iterations (default: 10)}

\item{\code{epsilon}}{Convergence threshold (default: 1e-3)}

\item{\code{ncores}}{Number of cores to use (default: 3)}

\item{\code{trace}}{Whether to return trace of parameter values (default: TRUE)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Fitted parameters or list of parameters and trace
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-optimize_tree"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-optimize_tree}{}}}
\subsection{Method \code{optimize_tree()}}{
Optimize tree using C++ implementation
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$optimize_tree(
  max_iter = 100,
  ncores = 1,
  outfile = NULL,
  resume = FALSE,
  trace_interval = 5
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{max_iter}}{Maximum number of iterations (default: 100)}

\item{\code{ncores}}{Number of cores to use (default: 1)}

\item{\code{outfile}}{Output file for saving results (optional)}

\item{\code{resume}}{Whether to resume from existing file (default: FALSE)}

\item{\code{trace_interval}}{Interval for saving trace (default: 5)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Optimization result object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-optimize_tree_em"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-optimize_tree_em}{}}}
\subsection{Method \code{optimize_tree_em()}}{
Alternating ML optimization and EM parameter updates until convergence
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$optimize_tree_em(
  total_iter = 100,
  ncores = 1,
  outfile = NULL,
  resume = FALSE,
  trace_interval = 5,
  em_max_iter = 100,
  em_epsilon = 0.001,
  em_ncores = 1,
  em_lower_bounds = c(ngen = 1, log_eps = log(1e-12), log_err = log(1e-12)),
  em_upper_bounds = c(ngen = 1000, log_eps = log(0.2), log_err = log(0.2))
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{total_iter}}{Upper bound for ML iterations per optimization phase (default: 100)}

\item{\code{ncores}}{Number of cores for ML optimization (default: 1)}

\item{\code{outfile}}{Output file for ML optimization trace (optional)}

\item{\code{resume}}{Whether to resume ML optimization from existing trace (default: FALSE)}

\item{\code{trace_interval}}{Interval for saving ML trace (default: 5)}

\item{\code{em_max_iter}}{EM iterations per EM step (default: 5)}

\item{\code{em_epsilon}}{Convergence tolerance for EM (default: 1e-3)}

\item{\code{em_ncores}}{Number of cores for EM E-step (default: 1)}

\item{\code{em_lower_bounds}}{Lower bounds for EM parameters in transformed space}

\item{\code{em_upper_bounds}}{Upper bounds for EM parameters in transformed space}
}
\if{html}{\out{</div>}}
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-run_mcmc"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-run_mcmc}{}}}
\subsection{Method \code{run_mcmc()}}{
Run phylogenetic MCMC sampling
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$run_mcmc(
  max_iter = 10000,
  nchains = 1000,
  ncores = 1,
  batch_size = 1000,
  outfile = NULL,
  resume = FALSE,
  diag = TRUE,
  use_nj = FALSE
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{max_iter}}{Maximum number of MCMC iterations (default: 10000)}

\item{\code{nchains}}{Number of MCMC chains (default: 1000)}

\item{\code{ncores}}{Number of cores to use (default: 1)}

\item{\code{batch_size}}{Batch size for MCMC (default: 1000)}

\item{\code{outfile}}{Output file for saving results (optional)}

\item{\code{resume}}{Whether to resume from existing file (default: FALSE)}

\item{\code{use_nj}}{Whether to use NJ tree instead of ML tree as initial tree (default: FALSE)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
MCMC result object
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-annotate_tree"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-annotate_tree}{}}}
\subsection{Method \code{annotate_tree()}}{
Trim tree using MCMC results
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$annotate_tree(
  burnin = 0,
  max_iter = 1e+08,
  use_nj = FALSE,
  ncores = 1,
  mcmc_trace_file = NULL
)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{burnin}}{Number of burnin iterations (default: 0)}

\item{\code{max_iter}}{Maximum iteration to include (default: 1e8)}

\item{\code{use_nj}}{Whether to use NJ tree instead of ML tree (default: FALSE)}

\item{\code{ncores}}{Number of cores to use (default: 1)}

\item{\code{mcmc_trace_file}}{MCMC result file (optional, uses stored file if NULL)}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
Trimmed tree with clade frequencies
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-copy"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-copy}{}}}
\subsection{Method \code{copy()}}{
Create a copy of a MitoDrift object with updated structure

This method creates a new MitoDrift instance with the same data but updated
class structure. Useful for refreshing objects created with older versions
of the code.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$copy(old_obj)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{old_obj}}{The old MitoDrift object to copy from}
}
\if{html}{\out{</div>}}
}
\subsection{Returns}{
A new MitoDrift object with the same data
}
}
\if{html}{\out{<hr>}}
\if{html}{\out{<a id="method-MitoDrift-clone"></a>}}
\if{latex}{\out{\hypertarget{method-MitoDrift-clone}{}}}
\subsection{Method \code{clone()}}{
The objects of this class are cloneable with this method.
\subsection{Usage}{
\if{html}{\out{<div class="r">}}\preformatted{MitoDrift$clone(deep = FALSE)}\if{html}{\out{</div>}}
}

\subsection{Arguments}{
\if{html}{\out{<div class="arguments">}}
\describe{
\item{\code{deep}}{Whether to make a deep clone.}
}
\if{html}{\out{</div>}}
}
}
}
